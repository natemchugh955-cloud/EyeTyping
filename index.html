<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Word Prediction Prototype</title>
  <style>
    body { font-family: Arial; text-align: center; margin: 20px; }
    #prompt { font-size: 1.5em; margin: 20px; }
    #output { font-size: 1.2em; margin: 10px; padding: 10px; border: 1px solid #ccc; min-height: 40px; }
    #prediction { font-size: 1em; color: blue; margin: 10px; }
    button { font-size: 1.5em; margin: 10px; padding: 10px 30px; }
  </style>
</head>
<body>
  <h1>Word Prediction Prototype</h1>
  <div id="prompt">Press Start to begin</div>
  <div id="output"></div>
  <div id="prediction"></div>
  <button onclick="start()">Start</button><br>
  <button onclick="respond(true)">Yes</button>
  <button onclick="respond(false)">No</button>

  <script>
    let dictionary = [];
    let currentWord = "";
    let candidateWords = [];
    let step = "idle";
    let nextLetters = [];
    let letterIndex = 0;

    const vowels = ["a","e","i","o","u"];
    const consonantOrder = ["t","n","s","h","r","d","l","c","m","w","f","g","y","p","b","v","j","k","x","q","z"];

    async function loadDictionary() {
      try {
        const response = await fetch("words.txt");
        const text = await response.text();
        dictionary = text.split(/\r?\n/)
          .map(w => w.trim().toLowerCase())
          .filter(w => w && w.length <= 20); // limit length for sanity
        console.log(`Loaded ${dictionary.length} words`);
      } catch (err) {
        console.error("Error loading dictionary:", err);
      }
    }

    function start() {
      currentWord = "";
      candidateWords = dictionary.slice();
      step = "vowelStart";
      document.getElementById("output").innerText = "";
      document.getElementById("prediction").innerText = "";
      document.getElementById("prompt").innerText = "Does the word start with a vowel?";
    }

    function respond(answer) {
      if (step === "vowelStart") {
        if (answer) {
          candidateWords = candidateWords.filter(w => vowels.includes(w[0]));
          nextLetters = vowels.slice();
        } else {
          candidateWords = candidateWords.filter(w => !vowels.includes(w[0]));
          nextLetters = consonantOrder.slice();
        }
        letterIndex = 0;
        step = "letterChoice";
        askNextLetter();
      } else if (step === "letterChoice") {
        if (answer) {
          let chosen = nextLetters[letterIndex];
          currentWord += chosen;
          candidateWords = candidateWords.filter(w => w.startsWith(currentWord));
          document.getElementById("output").innerText = currentWord;

          if (candidateWords.length === 0) {
            document.getElementById("prompt").innerText = `⚠️ No words match "${currentWord}" exactly, but you can continue spelling.`;
            proposeNextLetters(); // allow continuing
            return;
          }

          // If any word matches exactly, ask "Next word?"
          if (candidateWords.includes(currentWord)) {
            step = "nextWordPrompt";
            document.getElementById("prompt").innerText = `Word recognized: "${currentWord}". Next word?`;
            document.getElementById("prediction").innerText = "";
            return;
          }

          proposeNextLetters(); // predict next letters dynamically
        } else {
          letterIndex++;
          if (letterIndex >= nextLetters.length) {
            document.getElementById("prompt").innerText = "⚠️ No more valid letters.";
            step = "idle";
            document.getElementById("prediction").innerText = "";
          } else {
            document.getElementById("prompt").innerText = `Is the next letter "${nextLetters[letterIndex]}"?`;
          }
        }
      } else if (step === "nextWordPrompt") {
        if (answer) {
          currentWord += " ";
          document.getElementById("output").innerText = currentWord;
          candidateWords = dictionary.slice();
          step = "vowelStart";
          document.getElementById("prompt").innerText = "Does the word start with a vowel?";
        } else {
          step = "letterChoice";
          proposeNextLetters();
        }
      }
    }

    function askNextLetter() {
      if (letterIndex < nextLetters.length) {
        document.getElementById("prompt").innerText = `Is the next letter "${nextLetters[letterIndex]}"?`;
        document.getElementById("prediction").innerText = "Predicted letters: " + nextLetters.join(", ");
      } else {
        document.getElementById("prompt").innerText = "⚠️ No valid letters left.";
        document.getElementById("prediction").innerText = "";
        step = "idle";
      }
    }

    function proposeNextLetters() {
      let freq = {};
      for (let w of candidateWords) {
        if (w.startsWith(currentWord) && w.length > currentWord.length) {
          let nextChar = w[currentWord.length];
          freq[nextChar] = (freq[nextChar] || 0) + 1;
        }
      }

      let predicted = Object.entries(freq)
        .sort((a,b) => b[1]-a[1])
        .map(e=>e[0]);

      // Use fixed order for first letter of new word
      if (currentWord.length === 0) {
        // still ask consonants in order if not vowel
        nextLetters = nextLetters.slice();
      } else {
        nextLetters = predicted.length > 0 ? predicted : consonantOrder.slice();
      }

      letterIndex = 0;
      askNextLetter();
    }

    loadDictionary();
  </script>
</body>
</html>










