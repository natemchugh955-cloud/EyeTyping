<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Eye-Yes/No Communication</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 20px;
    }
    #prompt {
      font-size: 1.5em;
      margin: 20px;
    }
    #output {
      font-size: 1.2em;
      margin: 10px;
      padding: 10px;
      border: 1px solid #ccc;
      min-height: 40px;
    }
    button {
      font-size: 1.5em;
      margin: 10px;
      padding: 10px 30px;
    }
  </style>
</head>
<body>
  <h1>Eye Communication Prototype</h1>
  <div id="prompt">Press Start to begin</div>
  <div id="output"></div>
  <button onclick="start()">Start</button><br>
  <button onclick="respond(true)">Yes</button>
  <button onclick="respond(false)">No</button>

  <script>
    let dictionary = [];
    let currentWord = "";
    let candidateWords = [];
    let step = "idle";
    let nextLetters = [];
    let letterIndex = 0;

    async function loadDictionary() {
      try {
        const response = await fetch("words.txt");
        const text = await response.text();
        dictionary = text.split(/\r?\n/).map(w => w.trim().toLowerCase()).filter(w => w);
        console.log(`Loaded ${dictionary.length} words into dictionary`);
      } catch (err) {
        console.error("Error loading dictionary:", err);
      }
    }

    function start() {
      currentWord = "";
      candidateWords = dictionary.slice();
      step = "vowelStart";
      document.getElementById("output").innerText = "";
      document.getElementById("prompt").innerText = "Does the word start with a vowel?";
    }

    function respond(answer) {
      if (step === "vowelStart") {
        if (answer) {
          candidateWords = candidateWords.filter(w => /^[aeiou]/.test(w));
        } else {
          candidateWords = candidateWords.filter(w => /^[^aeiou]/.test(w));
        }
        if (candidateWords.length === 0) {
          document.getElementById("prompt").innerText = "⚠️ No words found.";
          return;
        }
        step = "letterChoice";
        proposeNextLetters();
      } else if (step === "letterChoice") {
        if (answer) {
          // accept current letter
          let chosen = nextLetters[letterIndex];
          currentWord += chosen;
          candidateWords = candidateWords.filter(w => w.startsWith(currentWord));
          document.getElementById("output").innerText = currentWord;

          if (candidateWords.length === 0) {
            document.getElementById("prompt").innerText = "⚠️ Word not found in dictionary.";
            step = "idle";
            return;
          }

          // check if complete word
          if (candidateWords.includes(currentWord)) {
            step = "nextWordPrompt";
            document.getElementById("prompt").innerText = `Word recognized: "${currentWord}". Next word?`;
            return;
          }
          // continue
          proposeNextLetters();
        } else {
          // move to next candidate letter
          letterIndex++;
          if (letterIndex >= nextLetters.length) {
            document.getElementById("prompt").innerText = "⚠️ No valid letters found.";
            step = "idle";
          } else {
            document.getElementById("prompt").innerText = `Is the next letter "${nextLetters[letterIndex]}"?`;
          }
        }
      } else if (step === "nextWordPrompt") {
        if (answer) {
          currentWord += " ";
          document.getElementById("output").innerText = currentWord;
          candidateWords = dictionary.slice();
          step = "vowelStart";
          document.getElementById("prompt").innerText = "Does the word start with a vowel?";
        } else {
          step = "letterChoice";
          proposeNextLetters();
        }
      }
    }

    function proposeNextLetters() {
      // gather next possible letters from candidate words
      let nextSet = {};
      for (let w of candidateWords) {
        if (w.startsWith(currentWord) && w.length > currentWord.length) {
          let nextChar = w[currentWord.length];
          nextSet[nextChar] = (nextSet[nextChar] || 0) + 1;
        }
      }
      nextLetters = Object.entries(nextSet)
        .sort((a,b) => b[1]-a[1])
        .map(e => e[0]);
      letterIndex = 0;

      if (nextLetters.length === 0) {
        document.getElementById("prompt").innerText = "⚠️ No possible next letters.";
        step = "idle";
      } else {
        document.getElementById("prompt").innerText = `Is the next letter "${nextLetters[letterIndex]}"?`;
      }
    }

    loadDictionary();
  </script>
</body>
</html>









