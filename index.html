<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Eye Controlled Sentence Builder</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin-top: 40px;
      background: #f4f4f4;
    }
    #display {
      font-size: 28px;
      margin: 20px;
      padding: 10px;
      background: white;
      border-radius: 8px;
      display: inline-block;
      min-width: 300px;
    }
    #prediction {
      margin: 20px;
      font-size: 20px;
      color: #333;
    }
    #controls button {
      font-size: 20px;
      margin: 10px;
      padding: 12px 24px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      background: #007bff;
      color: white;
    }
    #controls button:hover {
      background: #0056b3;
    }
  </style>
</head>
<body>
  <h1>Eye Controlled Sentence Builder</h1>
  <div id="display">Current: </div>
  <div id="prediction">Predicted Next Letters: </div>
  <div id="controls">
    <button onclick="yes()">YES (Look Up)</button>
    <button onclick="no()">NO (Look Down)</button>
  </div>

  <script>
    let words = [];
    let currentSentence = "";
    let currentWord = "";
    let letterQueue = [];
    let predicting = false;

    // Load words.txt dynamically
    fetch("words.txt")
      .then(res => res.text())
      .then(text => {
        words = text.split("\n").map(w => w.trim().toLowerCase()).filter(w => w.length > 0);
        console.log("Loaded", words.length, "words");
        startNewWord();
      });

    function startNewWord() {
      currentWord = "";
      letterQueue = ["vowel?"];
      predicting = false;
      updateDisplay();
    }

    function updateDisplay() {
      document.getElementById("display").innerText =
        "Current: " + currentSentence + currentWord;

      if (predicting && letterQueue.length > 0) {
        document.getElementById("prediction").innerText =
          "Predicted Next Letters: " + letterQueue.join(", ");
      } else {
        document.getElementById("prediction").innerText =
          "Predicted Next Letters: ...";
      }
    }

    function yes() {
      if (!predicting) {
        // First ask vowel or consonant
        if (letterQueue[0] === "vowel?") {
          letterQueue = ["a", "e", "i", "o", "u"];
          predicting = true;
        } else {
          acceptLetter(letterQueue[0]);
        }
      } else {
        acceptLetter(letterQueue[0]);
      }
      updateDisplay();
    }

    function no() {
      if (!predicting) {
        // They said "no" to vowel, show consonant order
        if (letterQueue[0] === "vowel?") {
          letterQueue = ["t","n","s","h","r","d","l","c","m","w",
                         "f","g","y","p","b","v","j","k","x","q","z"];
          predicting = true;
        }
      } else {
        letterQueue.shift(); // skip current option
      }
      updateDisplay();
    }

    function acceptLetter(letter) {
      currentWord += letter;
      console.log("Accepted:", currentWord);

      // Check if currentWord is a valid word
      if (words.includes(currentWord)) {
        letterQueue = ["next word?"];
        predicting = true;
      } else {
        // Predict next letters based on dictionary
        let nextLetters = {};
        words.forEach(w => {
          if (w.startsWith(currentWord) && w.length > currentWord.length) {
            let nextChar = w[currentWord.length];
            nextLetters[nextChar] = (nextLetters[nextChar] || 0) + 1;
          }
        });

        // Sort predicted letters by frequency
        letterQueue = Object.entries(nextLetters)
          .sort((a, b) => b[1] - a[1])
          .map(entry => entry[0]);

        if (letterQueue.length === 0) {
          // If no prediction, restart word
          letterQueue = ["vowel?"];
          predicting = false;
        }
      }
    }

    function handleNextWordYes() {
      currentSentence += currentWord + " ";
      startNewWord();
    }

    function handleNextWordNo() {
      // Keep spelling longer word
      let possible = words.filter(w => w.startsWith(currentWord));
      if (possible.length > 0) {
        let nextLetters = {};
        possible.forEach(w => {
          if (w.length > currentWord.length) {
            let nextChar = w[currentWord.length];
            nextLetters[nextChar] = (nextLetters[nextChar] || 0) + 1;
          }
        });
        letterQueue = Object.entries(nextLetters)
          .sort((a, b) => b[1] - a[1])
          .map(entry => entry[0]);
      } else {
        // Dead end
        letterQueue = ["vowel?"];
        predicting = false;
      }
    }

    // Extend yes/no for "next word?" case
    const oldYes = yes;
    const oldNo = no;
    yes = function() {
      if (letterQueue[0] === "next word?") {
        handleNextWordYes();
        updateDisplay();
      } else {
        oldYes();
      }
    };
    no = function() {
      if (letterQueue[0] === "next word?") {
        handleNextWordNo();
        updateDisplay();
      } else {
        oldNo();
      }
    };
  </script>
</body>
</html>


