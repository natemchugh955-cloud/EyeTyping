<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Eye Typing Prototype</title>
  <style>
    body { font-family: sans-serif; text-align: center; margin: 40px; }
    #prompt { font-size: 2em; margin: 20px; }
    #output { font-size: 1.5em; margin: 20px; }
    button { font-size: 1.5em; margin: 10px; padding: 10px 20px; }
  </style>
</head>
<body>
  <h1>Eye Typing Prototype</h1>
  <div id="prompt">Loading dictionary...</div>
  <div id="output"></div>
  <div>
    <button onclick="userYes()">YES (Look Up)</button>
    <button onclick="userNo()">NO (Look Down)</button>
  </div>

<script>
let dictionary = [];
let dictionaryLoaded = false;

// Load full 370k dictionary file (words.txt)
fetch("words.txt")
  .then(r => r.text())
  .then(txt => {
    dictionary = txt.split(/\r?\n/).map(w => w.toLowerCase()).filter(w => w.length > 0);
    dictionaryLoaded = true;
    startSession();
  })
  .catch(err => {
    console.warn("Could not load words.txt, falling back to mini dictionary");
    dictionary = ["hi","hello","pick","pickup","have","help","yes","no","mary","tell","she","can","drink"];
    dictionaryLoaded = true;
    startSession();
  });

let step = "idle";
let currentWord = "";
let sentence = [];
let predictedLetters = [];
let consonantOrder = ["T","N","S","H","R","D","L","C","M","W","F","G","Y","P","B","V","J","K","X","Q","Z"];

function updatePrompt(msg){ document.getElementById("prompt").innerText = msg; }
function updateOutput(){ document.getElementById("output").innerText = "Sentence: " + [...sentence,currentWord].join(" "); }

function startSession(){
  currentWord = "";
  sentence = [];
  updateOutput();
  step = "askVowel";
  updatePrompt("Is the first letter a vowel? (YES/NO)");
}

function computePredictedLetters(prefix){
  const possible = dictionary.filter(w => w.startsWith(prefix.toLowerCase()));
  let nextCounts = {};
  possible.forEach(w => {
    if(w.length > prefix.length){
      const next = w[prefix.length].toUpperCase();
      nextCounts[next] = (nextCounts[next] || 0) + 1;
    }
  });
  return Object.entries(nextCounts)
    .sort((a,b) => b[1]-a[1] || a[0].localeCompare(b[0]))
    .map(entry => entry[0]);
}

function addLetter(letter){
  currentWord += letter;
  updateOutput();

  // check exact word
  if(dictionary.includes(currentWord.toLowerCase())){
    step = "askNextWord";
    updatePrompt(`Word is "${currentWord}". Next word? (YES/NO)`);
    return;
  }

  // compute predictions
  predictedLetters = computePredictedLetters(currentWord);
  if(predictedLetters.length > 0){
    step = "predictLetter";
    updatePrompt("Is next letter '" + predictedLetters[0] + "'? (YES/NO)");
  } else {
    step = "askVowel";
    updatePrompt("No predictions found. Is it a vowel? (YES/NO)");
  }
}

function userYes(){
  if(step === "askVowel"){
    step = "askA"; updatePrompt("Is it A? (YES/NO)");
  }
  else if(step === "askA"){ addLetter("A"); }
  else if(step === "askE"){ addLetter("E"); }
  else if(step === "askI"){ addLetter("I"); }
  else if(step === "askO"){ addLetter("O"); }
  else if(step === "askU"){ addLetter("U"); }
  else if(step === "askConsonant"){
    addLetter(consonantOrder[0]);
    consonantOrder.push(consonantOrder.shift());
  }
  else if(step === "predictLetter"){
    addLetter(predictedLetters[0]);
  }
  else if(step === "askNextWord"){
    sentence.push(currentWord);
    currentWord = "";
    updateOutput();
    step = "askVowel";
    updatePrompt("Start next word. Is it a vowel? (YES/NO)");
  }
}

function userNo(){
  if(step === "askVowel"){
    step = "askConsonant"; updatePrompt("Is it " + consonantOrder[0] + "? (YES/NO)");
  }
  else if(step === "askA"){ step = "askE"; updatePrompt("Is it E? (YES/NO)"); }
  else if(step === "askE"){ step = "askI"; updatePrompt("Is it I? (YES/NO)"); }
  else if(step === "askI"){ step = "askO"; updatePrompt("Is it O? (YES/NO)"); }
  else if(step === "askO"){ step = "askU"; updatePrompt("Is it U? (YES/NO)"); }
  else if(step === "askU"){ step = "askConsonant"; updatePrompt("Is it " + consonantOrder[0] + "? (YES/NO)"); }
  else if(step === "askConsonant"){
    consonantOrder.push(consonantOrder.shift());
    updatePrompt("Is it " + consonantOrder[0] + "? (YES/NO)");
  }
  else if(step === "predictLetter"){
    predictedLetters.shift();
    if(predictedLetters.length > 0){
      updatePrompt("Is next letter '" + predictedLetters[0] + "'? (YES/NO)");
    } else {
      step = "askVowel";
      updatePrompt("No more predictions. Is it a vowel? (YES/NO)");
    }
  }
  else if(step === "askNextWord"){
    step = "askVowel";
    updatePrompt("Continue spelling. Is next letter a vowel? (YES/NO)");
  }
}
</script>
</body>
</html>
