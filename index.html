<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Eye Typing Prototype</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
    #prompt { font-size: 24px; margin: 20px; }
    #output { font-size: 20px; margin-top: 30px; }
    button { font-size: 18px; margin: 10px; padding: 10px 20px; }
  </style>
</head>
<body>
  <h2>Eye Typing Prototype (Button Test)</h2>
  <div id="prompt">Press "Start" to begin</div>
  <button onclick="yes()">YES (look up)</button>
  <button onclick="no()">NO (look down)</button>
  <button onclick="start()">Start</button>
  <div id="output"></div>

  <script>
    const vowels = ["A","E","I","O","U"];
    const consonants = ["T","N","S","H","R","D","L","C","M","W","F","G","Y","P","B","V","J","K","X","Q","Z"];
    const dictionary = ["tell","the","this","time","mary","she","can","have","a","drink","hello","you","me","yes","no","good","day","food","water","hi","him","hit"];

    let sentence = "";
    let currentWord = "";
    let step = "idle"; 
    let letterIndex = 0;
    let predictedNextLetter = null;

    function start(){
      sentence = "";
      currentWord = "";
      step = "askStart";
      updatePrompt("Start a new sentence? (YES to begin)");
    }

    function yes(){
      if(step === "askStart"){
        step = "askVowel";
        updatePrompt("Is it a vowel? (YES for vowels, NO for consonants)");
      } 
      else if(step === "askVowel"){
        step = "vowel";
        letterIndex = 0;
        showNextLetter();
      } 
      else if(step === "consonant"){
        addLetter(consonants[letterIndex]);
      } 
      else if(step === "vowel"){
        addLetter(vowels[letterIndex]);
      } 
      else if(step === "askNextWord"){
        // YES → confirm word, add to sentence, start next
        sentence += currentWord + " ";
        currentWord = "";
        step = "askVowel";
        updatePrompt("Is it a vowel? (YES for vowels, NO for consonants)");
        updateOutput();
      }
    }

    function no(){
      if(step === "askStart"){
        updatePrompt("Okay, not starting.");
        step = "idle";
      } 
      else if(step === "askVowel"){
        step = "consonant";
        letterIndex = 0;
        showNextLetter();
      } 
      else if(step === "consonant" || step === "vowel"){
        letterIndex++;
        showNextLetter();
      } 
      else if(step === "askNextWord"){
        // NO → keep spelling
        step = "askVowel";
        updatePrompt("Is it a vowel? (YES/NO)");
      }
    }

    function showNextLetter(){
      let list = (step === "consonant") ? consonants : vowels;
      if(letterIndex < list.length){
        updatePrompt("Letter: " + list[letterIndex] + " ? (YES/NO)");
      } else {
        updatePrompt("No more letters in this set. Restart word?");
        step = "askVowel";
      }
    }

    function addLetter(letter){
      currentWord += letter;
      updateOutput();

      // Check if current word is a full word
      if(dictionary.includes(currentWord.toLowerCase())){
        step = "askNextWord";
        updatePrompt("Word is '" + currentWord + "'. Next word? (YES/NO)");
        return;
      }

      // Predict next letter based on dictionary
      let possible = dictionary.filter(w => w.startsWith(currentWord.toLowerCase()));
      if(possible.length > 0){
        // collect next letters
        let nextLetters = {};
        for(let w of possible){
          if(w.length > currentWord.length){
            let next = w[currentWord.length].toUpperCase();
            nextLetters[next] = (nextLetters[next] || 0) + 1;
          }
        }
        // choose most common
        let best = Object.entries(nextLetters).sort((a,b) => b[1]-a[1])[0];
        if(best){
          predictedNextLetter = best[0];
          updatePrompt("Is next letter '" + predictedNextLetter + "'? (YES/NO)");
          step = "predictLetter";
          return;
        }
      }

      // If no prediction, continue asking vowel/consonant
      step = "askVowel";
      updatePrompt("Is it a vowel? (YES/NO)");
    }

    function updatePrompt(text){
      document.getElementById("prompt").innerText = text;
    }

    function updateOutput(){
      document.getElementById("output").innerText = "Current: " + sentence + currentWord;
    }

    // Handle prediction confirmation
    function yesPrediction(){
      addLetter(predictedNextLetter);
      predictedNextLetter = null;
    }

    function noPrediction(){
      predictedNextLetter = null;
      step = "askVowel";
      updatePrompt("Is it a vowel? (YES/NO)");
    }

    // Hook prediction into buttons
    const oldYes = yes;
    const oldNo = no;
    yes = function(){
      if(step === "predictLetter"){
        yesPrediction();
      } else {
        oldYes();
      }
    };
    no = function(){
      if(step === "predictLetter"){
        noPrediction();
      } else {
        oldNo();
      }
    };
  </script>
</body>
</html>
